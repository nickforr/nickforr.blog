---
title: Rainfall
author: nickforr
date: '2017-07-09'
slug: rainfall
categories: 
  - R
tags: 
  - ggplot2
  - tidyverse
description: ''
draft: true
topics:
  - R
---



<div id="wetter-in-the-west-of-scotland" class="section level2">
<h2>Wetter in the West (of Scotland)?</h2>
<p>I grew up in <a href="https://en.wikipedia.org/wiki/Fife">Fife</a> and now live on the outskirts of Glasgow. And maybe it’s just the ‘lovely’ July weather we’re currently experiencing, or maybe it’s just that I’m getting older and have a selective memory for the past, but I don’t recall summers being quite so wet when I was growing up!</p>
<p>I thought I’d take the opportunity to explore the data and play around with some visualisation…</p>
<div id="data-from-met-office" class="section level3">
<h3>Data from Met Office</h3>
<p>The Met Office provides <a href="http://www.metoffice.gov.uk/public/weather/climate-historic/#?tab=climateHistoric">historic data</a> from weather stations across the UK and the stations at Leuchars (in Fife) and Paisley (just to the west of Glasgow) have data going back to the 1950s.</p>
<pre class="r"><code>library(tidyverse)</code></pre>
<pre><code>## Loading tidyverse: ggplot2
## Loading tidyverse: tibble
## Loading tidyverse: tidyr
## Loading tidyverse: readr
## Loading tidyverse: purrr
## Loading tidyverse: dplyr</code></pre>
<pre><code>## Warning: package &#39;dplyr&#39; was built under R version 3.4.1</code></pre>
<pre><code>## Conflicts with tidy packages ----------------------------------------------</code></pre>
<pre><code>## filter(): dplyr, stats
## lag():    dplyr, stats</code></pre>
<pre class="r"><code>library(stringr)
library(viridis)</code></pre>
<pre><code>## Loading required package: viridisLite</code></pre>
<pre class="r"><code>library(hrbrthemes)</code></pre>
<pre class="r"><code>#Data is a bit messy in txt format (although they do have a help page on how to use the Excel &#39;text to columns wizard&#39; to import the data...!)
leucharsRawData &lt;- 
  readr::read_lines(&quot;http://www.metoffice.gov.uk/pub/data/weather/uk/climate/stationdata/leucharsdata.txt&quot;, skip = 5) %&gt;% #skip first five lines of explanations
  stringr::str_trim() %&gt;% #remove whitespace
  stringr::str_split(stringr::boundary(&quot;word&quot;)) %&gt;% #split lines into columns
  purrr::discard(~(&quot;Provisional&quot; %in% .x)) #Remove recent provisional results
paisleyRawData &lt;- 
  readr::read_lines(&quot;http://www.metoffice.gov.uk/pub/data/weather/uk/climate/stationdata/paisleydata.txt&quot;, skip = 5) %&gt;%
  stringr::str_trim() %&gt;% #remove whitespace
  stringr::str_split(stringr::boundary(&quot;word&quot;)) %&gt;% #split lines into columns
  purrr::discard(~(&quot;Provisional&quot; %in% .x)) #Remove recent provisional results

#Check that column names are the same
stopifnot(leucharsRawData[[1]] == paisleyRawData[[1]])

#Note that 2nd row of each resulting list is an unhelpful second row of column headers
leucharsData &lt;- 
  tail(leucharsRawData, -2) %&gt;%
   purrr::map_df(~set_names(as.list(as.numeric(.x)), leucharsRawData[[1]])) %&gt;%
  dplyr::mutate(dataDate = lubridate::dmy(paste(01, mm, yyyy, sep = &quot;_&quot;))) %&gt;%
  select(-yyyy, -mm)
paisleyData &lt;- 
  tail(paisleyRawData, -2) %&gt;%
   purrr::map_df(~set_names(as.list(as.numeric(.x)), paisleyRawData[[1]])) %&gt;%
  dplyr::mutate(dataDate = lubridate::dmy(paste(01, mm, yyyy, sep = &quot;_&quot;))) %&gt;%
  select(-yyyy, -mm)

allData &lt;- 
  list(Leuchars = leucharsData, Paisley = paisleyData) %&gt;%
  dplyr::bind_rows(.id = &quot;station&quot;) %&gt;%
  dplyr::filter(
    dataDate &gt;= max(min(leucharsData$dataDate), min(paisleyData$dataDate)))</code></pre>
</div>
</div>
